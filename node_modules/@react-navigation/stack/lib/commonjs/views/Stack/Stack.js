var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf3=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var React=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _reactNativeReanimated=_interopRequireDefault(require("react-native-reanimated"));var Screens=_interopRequireWildcard(require("react-native-screens"));var _HeaderSegment=require("../Header/HeaderSegment");var _StackItem=_interopRequireDefault(require("./StackItem"));var _TransitionPresets=require("../../TransitionConfigs/TransitionPresets");var _HeaderStyleInterpolators=require("../../TransitionConfigs/HeaderStyleInterpolators");var _jsxFileName="/Users/satya/Workspace/Projects/navigation-ex/packages/stack/src/views/Stack/Stack.tsx";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}var dimensions=_reactNative.Dimensions.get('window');var layout={width:dimensions.width,height:dimensions.height};var AnimatedScreen;var MaybeScreenContainer=function MaybeScreenContainer(_ref){var enabled=_ref.enabled,rest=(0,_objectWithoutProperties2.default)(_ref,["enabled"]);if(_reactNative.Platform.OS!=='ios'&&enabled&&Screens.screensEnabled()){return React.createElement(Screens.ScreenContainer,(0,_extends2.default)({},rest,{__source:{fileName:_jsxFileName,lineNumber:86}}));}return React.createElement(_reactNative.View,(0,_extends2.default)({},rest,{__source:{fileName:_jsxFileName,lineNumber:89}}));};var MaybeScreen=function MaybeScreen(_ref2){var enabled=_ref2.enabled,active=_ref2.active,rest=(0,_objectWithoutProperties2.default)(_ref2,["enabled","active"]);if(_reactNative.Platform.OS!=='ios'&&enabled&&Screens.screensEnabled()){AnimatedScreen=AnimatedScreen||_reactNativeReanimated.default.createAnimatedComponent(Screens.NativeScreen);return React.createElement(AnimatedScreen,(0,_extends2.default)({active:active},rest,{__source:{fileName:_jsxFileName,lineNumber:105}}));}return React.createElement(_reactNative.View,(0,_extends2.default)({},rest,{__source:{fileName:_jsxFileName,lineNumber:108}}));};var cond=_reactNativeReanimated.default.cond,eq=_reactNativeReanimated.default.eq;var ANIMATED_ONE=new _reactNativeReanimated.default.Value(1);var FALLBACK_DESCRIPTOR=Object.freeze({options:{}});var getFloatingHeaderHeights=function getFloatingHeaderHeights(routes,insets,descriptors,layout,previous){var defaultHeaderHeight=(0,_HeaderSegment.getDefaultHeaderHeight)(layout,insets);return routes.reduce(function(acc,curr){var _ref3=descriptors[curr.key]||{},_ref3$options=_ref3.options,options=_ref3$options===void 0?{}:_ref3$options;var _StyleSheet$flatten=_reactNative.StyleSheet.flatten(options.headerStyle||{}),_StyleSheet$flatten$h=_StyleSheet$flatten.height,height=_StyleSheet$flatten$h===void 0?previous[curr.key]:_StyleSheet$flatten$h;acc[curr.key]=typeof height==='number'?height:defaultHeaderHeight;return acc;},{});};var Stack=function(_React$Component){(0,_inherits2.default)(Stack,_React$Component);function Stack(){var _getPrototypeOf2;var _this;(0,_classCallCheck2.default)(this,Stack);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=(0,_possibleConstructorReturn2.default)(this,(_getPrototypeOf2=(0,_getPrototypeOf3.default)(Stack)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={routes:[],scenes:[],progress:{},layout:layout,descriptors:_this.props.descriptors,floatingHeaderHeights:{}};_this.handleLayout=function(e){var _e$nativeEvent$layout=e.nativeEvent.layout,height=_e$nativeEvent$layout.height,width=_e$nativeEvent$layout.width;if(height===_this.state.layout.height&&width===_this.state.layout.width){return;}var layout={width:width,height:height};_this.setState(function(state){return{layout:layout,floatingHeaderHeights:getFloatingHeaderHeights(_this.props.routes,_this.props.insets,state.descriptors,layout,{})};});};_this.handleFloatingHeaderLayout=function(_ref4){var route=_ref4.route,height=_ref4.height;var previousHeight=_this.state.floatingHeaderHeights[route.key];if(previousHeight&&previousHeight===height){return;}_this.setState(function(state){return{floatingHeaderHeights:_objectSpread({},state.floatingHeaderHeights,(0,_defineProperty2.default)({},route.key,height))};});};_this.handleTransitionStart=function(_ref5,closing){var route=_ref5.route;return _this.props.navigation.emit({type:'transitionStart',data:{closing:closing},target:route.key});};_this.handleTransitionEnd=function(_ref6,closing){var route=_ref6.route;return _this.props.navigation.emit({type:'transitionEnd',data:{closing:closing},target:route.key});};return _this;}(0,_createClass2.default)(Stack,[{key:"render",value:function render(){var _this2=this;var _this$props=this.props,mode=_this$props.mode,insets=_this$props.insets,descriptors=_this$props.descriptors,state=_this$props.state,navigation=_this$props.navigation,routes=_this$props.routes,closingRouteKeys=_this$props.closingRouteKeys,onOpenRoute=_this$props.onOpenRoute,onCloseRoute=_this$props.onCloseRoute,onGoBack=_this$props.onGoBack,getPreviousRoute=_this$props.getPreviousRoute,getGesturesEnabled=_this$props.getGesturesEnabled,renderHeader=_this$props.renderHeader,renderScene=_this$props.renderScene,headerMode=_this$props.headerMode,onPageChangeStart=_this$props.onPageChangeStart,onPageChangeConfirm=_this$props.onPageChangeConfirm,onPageChangeCancel=_this$props.onPageChangeCancel;var _this$state=this.state,scenes=_this$state.scenes,layout=_this$state.layout,progress=_this$state.progress,floatingHeaderHeights=_this$state.floatingHeaderHeights;var focusedRoute=state.routes[state.index];var focusedDescriptor=descriptors[focusedRoute.key];var focusedOptions=focusedDescriptor?focusedDescriptor.options:{};var defaultTransitionPreset=mode==='modal'?_TransitionPresets.ModalTransition:_TransitionPresets.DefaultTransition;if(headerMode==='screen'){defaultTransitionPreset=_objectSpread({},defaultTransitionPreset,{headerStyleInterpolator:_HeaderStyleInterpolators.forNoAnimation});}var _ref7=focusedOptions.safeAreaInsets||{},_ref7$top=_ref7.top,top=_ref7$top===void 0?insets.top:_ref7$top,_ref7$right=_ref7.right,right=_ref7$right===void 0?insets.right:_ref7$right,_ref7$bottom=_ref7.bottom,bottom=_ref7$bottom===void 0?insets.bottom:_ref7$bottom,_ref7$left=_ref7.left,left=_ref7$left===void 0?insets.left:_ref7$left;return React.createElement(React.Fragment,{__source:{fileName:_jsxFileName,lineNumber:340}},React.createElement(MaybeScreenContainer,{enabled:mode!=='modal',style:styles.container,onLayout:this.handleLayout,__source:{fileName:_jsxFileName,lineNumber:341}},routes.map(function(route,index,self){var focused=focusedRoute.key===route.key;var current=progress[route.key];var scene=scenes[index];var next=self[index+1]?progress[self[index+1].key]:ANIMATED_ONE;var isScreenActive=index===self.length-1?1:_reactNative.Platform.OS==='android'?cond(eq(next,1),0,1):index===self.length-2?1:0;var _ref8=scene.descriptor?scene.descriptor.options:{},safeAreaInsets=_ref8.safeAreaInsets,headerShown=_ref8.headerShown,headerTransparent=_ref8.headerTransparent,cardTransparent=_ref8.cardTransparent,cardShadowEnabled=_ref8.cardShadowEnabled,cardOverlayEnabled=_ref8.cardOverlayEnabled,cardStyle=_ref8.cardStyle,gestureResponseDistance=_ref8.gestureResponseDistance,gestureVelocityImpact=_ref8.gestureVelocityImpact,_ref8$gestureDirectio=_ref8.gestureDirection,gestureDirection=_ref8$gestureDirectio===void 0?defaultTransitionPreset.gestureDirection:_ref8$gestureDirectio,_ref8$transitionSpec=_ref8.transitionSpec,transitionSpec=_ref8$transitionSpec===void 0?defaultTransitionPreset.transitionSpec:_ref8$transitionSpec,_ref8$cardStyleInterp=_ref8.cardStyleInterpolator,cardStyleInterpolator=_ref8$cardStyleInterp===void 0?defaultTransitionPreset.cardStyleInterpolator:_ref8$cardStyleInterp,_ref8$headerStyleInte=_ref8.headerStyleInterpolator,headerStyleInterpolator=_ref8$headerStyleInte===void 0?defaultTransitionPreset.headerStyleInterpolator:_ref8$headerStyleInte;var transitionConfig={transitionSpec:transitionSpec,cardStyleInterpolator:cardStyleInterpolator,headerStyleInterpolator:headerStyleInterpolator};if(index!==self.length-1){var nextScene=scenes[index+1];if(nextScene){var _ref9=nextScene.descriptor?nextScene.descriptor.options:{},_ref9$transitionSpec=_ref9.transitionSpec,_transitionSpec=_ref9$transitionSpec===void 0?defaultTransitionPreset.transitionSpec:_ref9$transitionSpec,_ref9$cardStyleInterp=_ref9.cardStyleInterpolator,_cardStyleInterpolator=_ref9$cardStyleInterp===void 0?defaultTransitionPreset.cardStyleInterpolator:_ref9$cardStyleInterp,_ref9$headerStyleInte=_ref9.headerStyleInterpolator,_headerStyleInterpolator=_ref9$headerStyleInte===void 0?defaultTransitionPreset.headerStyleInterpolator:_ref9$headerStyleInte;transitionConfig={transitionSpec:_transitionSpec,cardStyleInterpolator:_cardStyleInterpolator,headerStyleInterpolator:_headerStyleInterpolator};}}var _ref10=safeAreaInsets||{},_ref10$top=_ref10.top,safeAreaInsetTop=_ref10$top===void 0?insets.top:_ref10$top,_ref10$right=_ref10.right,safeAreaInsetRight=_ref10$right===void 0?insets.right:_ref10$right,_ref10$bottom=_ref10.bottom,safeAreaInsetBottom=_ref10$bottom===void 0?insets.bottom:_ref10$bottom,_ref10$left=_ref10.left,safeAreaInsetLeft=_ref10$left===void 0?insets.left:_ref10$left;return React.createElement(MaybeScreen,{key:route.key,style:_reactNative.StyleSheet.absoluteFill,enabled:mode!=='modal',active:isScreenActive,pointerEvents:"box-none",__source:{fileName:_jsxFileName,lineNumber:422}},React.createElement(_StackItem.default,(0,_extends2.default)({index:index,active:index===self.length-1,focused:focused,closing:closingRouteKeys.includes(route.key),layout:layout,current:current,scene:scene,previousScene:scenes[index-1],navigation:navigation,state:state,safeAreaInsetTop:safeAreaInsetTop,safeAreaInsetRight:safeAreaInsetRight,safeAreaInsetBottom:safeAreaInsetBottom,safeAreaInsetLeft:safeAreaInsetLeft,cardTransparent:cardTransparent,cardOverlayEnabled:cardOverlayEnabled,cardShadowEnabled:cardShadowEnabled,cardStyle:cardStyle,onPageChangeStart:onPageChangeStart,onPageChangeConfirm:onPageChangeConfirm,onPageChangeCancel:onPageChangeCancel,gestureResponseDistance:gestureResponseDistance,floatingHeaderHeight:floatingHeaderHeights[route.key],getPreviousRoute:getPreviousRoute,headerMode:headerMode,headerShown:headerShown,headerTransparent:headerTransparent,renderHeader:renderHeader,renderScene:renderScene,onOpenRoute:onOpenRoute,onCloseRoute:onCloseRoute,onTransitionStart:_this2.handleTransitionStart,onTransitionEnd:_this2.handleTransitionEnd,onGoBack:onGoBack,gestureEnabled:index!==0&&getGesturesEnabled({route:route}),gestureVelocityImpact:gestureVelocityImpact,gestureDirection:gestureDirection},transitionConfig,{__source:{fileName:_jsxFileName,lineNumber:429}})));})),headerMode==='float'?renderHeader({mode:'float',layout:layout,insets:{top:top,right:right,bottom:bottom,left:left},scenes:scenes,state:state,getPreviousRoute:getPreviousRoute,onContentHeightChange:this.handleFloatingHeaderLayout,styleInterpolator:focusedOptions.headerStyleInterpolator!==undefined?focusedOptions.headerStyleInterpolator:defaultTransitionPreset.headerStyleInterpolator,style:styles.floating}):null);}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,state){if(props.routes===state.routes&&props.descriptors===state.descriptors){return null;}var progress=props.routes.reduce(function(acc,curr){var descriptor=props.descriptors[curr.key];acc[curr.key]=state.progress[curr.key]||new _reactNativeReanimated.default.Value(props.openingRouteKeys.includes(curr.key)&&descriptor&&descriptor.options.animationEnabled!==false?0:1);return acc;},{});return{routes:props.routes,scenes:props.routes.map(function(route,index,self){var previousRoute=self[index-1];var nextRoute=self[index+1];var current=progress[route.key];var previous=previousRoute?progress[previousRoute.key]:undefined;var next=nextRoute?progress[nextRoute.key]:undefined;var oldScene=state.scenes[index];var scene={route:route,previous:previousRoute,descriptor:props.descriptors[route.key]||state.descriptors[route.key]||(oldScene?oldScene.descriptor:FALLBACK_DESCRIPTOR),progress:{current:current,next:next,previous:previous}};if(oldScene&&scene.route===oldScene.route&&scene.progress.current===oldScene.progress.current&&scene.progress.next===oldScene.progress.next&&scene.progress.previous===oldScene.progress.previous&&scene.descriptor===oldScene.descriptor){return oldScene;}return scene;}),progress:progress,descriptors:props.descriptors,floatingHeaderHeights:getFloatingHeaderHeights(props.routes,props.insets,state.descriptors,state.layout,state.floatingHeaderHeights)};}}]);return Stack;}(React.Component);exports.default=Stack;var styles=_reactNative.StyleSheet.create({container:{flex:1,overflow:'hidden'},floating:{position:'absolute',top:0,left:0,right:0}});
//# sourceMappingURL=Stack.js.map