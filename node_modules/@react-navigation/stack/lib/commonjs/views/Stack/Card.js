var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf3=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var React=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _reactNativeReanimated=_interopRequireDefault(require("react-native-reanimated"));var _reactNativeGestureHandler=require("react-native-gesture-handler");var _PointerEventsView=_interopRequireDefault(require("./PointerEventsView"));var _memoize=_interopRequireDefault(require("../../utils/memoize"));var _StackGestureContext=_interopRequireDefault(require("../../utils/StackGestureContext"));var _jsxFileName="/Users/satya/Workspace/Projects/navigation-ex/packages/stack/src/views/Stack/Card.tsx";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}var TRUE=1;var TRUE_NODE=new _reactNativeReanimated.default.Value(TRUE);var FALSE=0;var FALSE_NODE=new _reactNativeReanimated.default.Value(FALSE);var NOOP_NODE=FALSE_NODE;var UNSET=-1;var UNSET_NODE=new _reactNativeReanimated.default.Value(UNSET);var MINUS_ONE_NODE=UNSET_NODE;var DIRECTION_VERTICAL=-1;var DIRECTION_HORIZONTAL=1;var GESTURE_VELOCITY_IMPACT=0.3;var GESTURE_RESPONSE_DISTANCE_HORIZONTAL=50;var GESTURE_RESPONSE_DISTANCE_VERTICAL=135;var abs=_reactNativeReanimated.default.abs,add=_reactNativeReanimated.default.add,block=_reactNativeReanimated.default.block,call=_reactNativeReanimated.default.call,cond=_reactNativeReanimated.default.cond,divide=_reactNativeReanimated.default.divide,eq=_reactNativeReanimated.default.eq,greaterThan=_reactNativeReanimated.default.greaterThan,lessThan=_reactNativeReanimated.default.lessThan,max=_reactNativeReanimated.default.max,min=_reactNativeReanimated.default.min,multiply=_reactNativeReanimated.default.multiply,neq=_reactNativeReanimated.default.neq,onChange=_reactNativeReanimated.default.onChange,set=_reactNativeReanimated.default.set,spring=_reactNativeReanimated.default.spring,sub=_reactNativeReanimated.default.sub,timing=_reactNativeReanimated.default.timing,startClock=_reactNativeReanimated.default.startClock,stopClock=_reactNativeReanimated.default.stopClock,clockRunning=_reactNativeReanimated.default.clockRunning,Clock=_reactNativeReanimated.default.Clock,Value=_reactNativeReanimated.default.Value;var memoizedSpring=spring;if(_reactNativeReanimated.default.proc){var springHelper=_reactNativeReanimated.default.proc(function(finished,velocity,position,time,prevPosition,toValue,damping,mass,stiffness,overshootClamping,restSpeedThreshold,restDisplacementThreshold,clock){return spring(clock,{finished:finished,velocity:velocity,position:position,time:time,prevPosition:prevPosition},{toValue:toValue,damping:damping,mass:mass,stiffness:stiffness,overshootClamping:overshootClamping,restDisplacementThreshold:restDisplacementThreshold,restSpeedThreshold:restSpeedThreshold});});memoizedSpring=function memoizedSpring(clock,state,config){return springHelper(state.finished,state.velocity,state.position,state.time,new Value(0),config.toValue,config.damping,config.mass,config.stiffness,config.overshootClamping,config.restSpeedThreshold,config.restDisplacementThreshold,clock);};}function transformSpringConfigToAnimatedValues(config){return{damping:new _reactNativeReanimated.default.Value(config.damping),stiffness:new _reactNativeReanimated.default.Value(config.stiffness),mass:new _reactNativeReanimated.default.Value(config.mass),restDisplacementThreshold:new _reactNativeReanimated.default.Value(config.restDisplacementThreshold),restSpeedThreshold:new _reactNativeReanimated.default.Value(config.restSpeedThreshold),overshootClamping:new _reactNativeReanimated.default.Value(config.overshootClamping)};}function transformTimingConfigToAnimatedValues(config){return{duration:new _reactNativeReanimated.default.Value(config.duration),easing:config.easing};}var Card=function(_React$Component){(0,_inherits2.default)(Card,_React$Component);function Card(){var _getPrototypeOf2;var _this;(0,_classCallCheck2.default)(this,Card);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=(0,_possibleConstructorReturn2.default)(this,(_getPrototypeOf2=(0,_getPrototypeOf3.default)(Card)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.isVisible=new Value(TRUE);_this.nextIsVisible=new Value(UNSET);_this.isClosing=new Value(FALSE);_this.noAnimationStartedSoFar=true;_this.isRunningAnimation=false;_this.clock=new Clock();_this.direction=new Value(_this.props.gestureDirection==='vertical'?DIRECTION_VERTICAL:DIRECTION_HORIZONTAL);_this.layout={width:new Value(_this.props.layout.width),height:new Value(_this.props.layout.height)};_this.gestureVelocityImpact=new Value(_this.props.gestureVelocityImpact);_this.openingSpecConfig=_this.props.transitionSpec.open.animation==='timing'?transformTimingConfigToAnimatedValues(_this.props.transitionSpec.open.config):transformSpringConfigToAnimatedValues(_this.props.transitionSpec.open.config);_this.closingSpecConfig=_this.props.transitionSpec.close.animation==='timing'?transformTimingConfigToAnimatedValues(_this.props.transitionSpec.close.config):transformSpringConfigToAnimatedValues(_this.props.transitionSpec.close.config);_this.distance=cond(eq(_this.direction,DIRECTION_VERTICAL),_this.layout.height,_this.layout.width);_this.gestureUntraversed=new Value(0);_this.gesture=new Value(0);_this.offset=new Value(0);_this.velocityUntraversed=new Value(0);_this.velocity=new Value(0);_this.gestureState=new Value(0);_this.isSwiping=new Value(FALSE);_this.isSwipeCancelled=new Value(FALSE);_this.isSwipeGesture=new Value(FALSE);_this.toValue=new Value(0);_this.frameTime=new Value(0);_this.transitionVelocity=new Value(0);_this.transitionState={position:_this.props.current,time:new Value(0),finished:new Value(FALSE)};_this.handleStartInteraction=function(){if(_this.interactionHandle===undefined){_this.interactionHandle=_reactNative.InteractionManager.createInteractionHandle();}};_this.handleEndInteraction=function(){if(_this.interactionHandle!==undefined){_reactNative.InteractionManager.clearInteractionHandle(_this.interactionHandle);_this.interactionHandle=undefined;}};_this.handleTransitionEnd=function(){_this.handleEndInteraction();_this.isRunningAnimation=false;_this.interpolatedStyle=_this.getInterpolatedStyle(_this.props.styleInterpolator,_this.props.index,_this.props.current,_this.props.next,_this.props.layout,_this.props.insets.top,_this.props.insets.right,_this.props.insets.bottom,_this.props.insets.left);};_this.runTransition=function(isVisible){var _this$props$transitio=_this.props.transitionSpec,openingSpec=_this$props$transitio.open,closingSpec=_this$props$transitio.close;return cond(eq(_this.props.current,isVisible),NOOP_NODE,[cond(clockRunning(_this.clock),NOOP_NODE,[set(_this.toValue,isVisible),set(_this.transitionVelocity,multiply(cond(_this.distance,divide(_this.velocity,_this.distance),FALSE_NODE),-1)),set(_this.frameTime,FALSE_NODE),set(_this.transitionState.time,FALSE_NODE),set(_this.transitionState.finished,FALSE_NODE),set(_this.isVisible,isVisible),startClock(_this.clock),call([_this.isVisible],function(_ref){var _ref2=(0,_slicedToArray2.default)(_ref,1),value=_ref2[0];_this.handleStartInteraction();var onTransitionStart=_this.props.onTransitionStart;_this.noAnimationStartedSoFar=false;_this.isRunningAnimation=true;onTransitionStart&&onTransitionStart({closing:!value});})]),cond(eq(isVisible,TRUE_NODE),openingSpec.animation==='spring'?memoizedSpring(_this.clock,_objectSpread({},_this.transitionState,{velocity:_this.transitionVelocity}),_objectSpread({},_this.openingSpecConfig,{toValue:_this.toValue})):timing(_this.clock,_objectSpread({},_this.transitionState,{frameTime:_this.frameTime}),_objectSpread({},_this.openingSpecConfig,{toValue:_this.toValue})),closingSpec.animation==='spring'?memoizedSpring(_this.clock,_objectSpread({},_this.transitionState,{velocity:_this.transitionVelocity}),_objectSpread({},_this.closingSpecConfig,{toValue:_this.toValue})):timing(_this.clock,_objectSpread({},_this.transitionState,{frameTime:_this.frameTime}),_objectSpread({},_this.closingSpecConfig,{toValue:_this.toValue}))),cond(_this.transitionState.finished,[set(_this.isSwipeGesture,FALSE_NODE),set(_this.gesture,FALSE_NODE),set(_this.velocity,FALSE_NODE),stopClock(_this.clock),call([_this.isVisible],function(_ref3){var _ref4=(0,_slicedToArray2.default)(_ref3,1),value=_ref4[0];var isOpen=Boolean(value);var _this$props=_this.props,onOpen=_this$props.onOpen,onClose=_this$props.onClose;_this.handleTransitionEnd();if(isOpen){onOpen(true);}else{onClose(true);}})])]);};_this.extrapolatedPosition=add(_this.gesture,multiply(_this.velocity,_this.gestureVelocityImpact));_this.exec=[set(_this.gesture,cond(eq(_this.direction,DIRECTION_HORIZONTAL),multiply(_this.gestureUntraversed,_reactNative.I18nManager.isRTL?MINUS_ONE_NODE:TRUE_NODE),_this.gestureUntraversed)),set(_this.velocity,multiply(_this.velocityUntraversed,_reactNative.I18nManager.isRTL?MINUS_ONE_NODE:TRUE_NODE)),onChange(_this.isClosing,cond(_this.isClosing,set(_this.nextIsVisible,FALSE_NODE))),onChange(_this.nextIsVisible,cond(neq(_this.nextIsVisible,UNSET_NODE),[cond(clockRunning(_this.clock),[call([],_this.handleTransitionEnd),stopClock(_this.clock)]),set(_this.gesture,FALSE_NODE),set(_this.isVisible,_this.nextIsVisible),set(_this.nextIsVisible,UNSET_NODE)]))];_this.execNoGesture=block([].concat((0,_toConsumableArray2.default)(_this.exec),[_this.runTransition(_this.isVisible)]));_this.execWithGesture=block([].concat((0,_toConsumableArray2.default)(_this.exec),[onChange(_this.isSwiping,call([_this.isSwiping,_this.isSwipeCancelled],function(_ref5){var _ref6=(0,_slicedToArray2.default)(_ref5,2),isSwiping=_ref6[0],isSwipeCancelled=_ref6[1];var _this$props2=_this.props,onGestureBegin=_this$props2.onGestureBegin,onGestureEnd=_this$props2.onGestureEnd,onGestureCanceled=_this$props2.onGestureCanceled;if(isSwiping===TRUE){_this.handleStartInteraction();onGestureBegin&&onGestureBegin();}else{_this.handleEndInteraction();if(isSwipeCancelled===TRUE){onGestureCanceled&&onGestureCanceled();}else{onGestureEnd&&onGestureEnd();}}})),cond(eq(_this.gestureState,_reactNativeGestureHandler.State.ACTIVE),[cond(_this.isSwiping,NOOP_NODE,[set(_this.isSwipeCancelled,FALSE_NODE),set(_this.isSwiping,TRUE_NODE),set(_this.isSwipeGesture,TRUE_NODE),set(_this.offset,_this.props.current)]),set(_this.props.current,min(max(sub(_this.offset,cond(_this.distance,divide(cond(eq(_this.direction,DIRECTION_HORIZONTAL),multiply(_this.gestureUntraversed,_reactNative.I18nManager.isRTL?MINUS_ONE_NODE:TRUE_NODE),_this.gestureUntraversed),_this.distance),TRUE_NODE)),FALSE_NODE),TRUE_NODE)),cond(clockRunning(_this.clock),call([],function(){_this.isRunningAnimation=false;})),stopClock(_this.clock)],[set(_this.isSwipeCancelled,eq(_this.gestureState,_reactNativeGestureHandler.State.CANCELLED)),set(_this.isSwiping,FALSE_NODE),_this.runTransition(cond(greaterThan(abs(_this.extrapolatedPosition),divide(_this.distance,2)),cond(lessThan(cond(eq(_this.velocity,FALSE_NODE),_this.gesture,_this.velocity),FALSE_NODE),TRUE_NODE,FALSE_NODE),_this.isVisible))])]));_this.handleGestureEventHorizontal=_reactNativeReanimated.default.event([{nativeEvent:{translationX:_this.gestureUntraversed,velocityX:_this.velocityUntraversed,state:_this.gestureState}}]);_this.handleGestureEventVertical=_reactNativeReanimated.default.event([{nativeEvent:{translationY:_this.gestureUntraversed,velocityY:_this.velocityUntraversed,state:_this.gestureState}}]);_this.getInterpolatedStyle=(0,_memoize.default)(function(styleInterpolator,index,current,next,layout,insetTop,insetRight,insetBottom,insetLeft){return styleInterpolator({index:index,current:{progress:current},next:next&&{progress:next},closing:_this.isClosing,layouts:{screen:layout},insets:{top:insetTop,right:insetRight,bottom:insetBottom,left:insetLeft}});});_this.interpolatedStyle=_this.getInterpolatedStyle(_this.props.styleInterpolator,_this.props.index,_this.props.current,_this.props.next,_this.props.layout,_this.props.insets.top,_this.props.insets.right,_this.props.insets.bottom,_this.props.insets.left);_this.gestureRef=React.createRef();return _this;}(0,_createClass2.default)(Card,[{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var _this2=this;var _this$props3=this.props,layout=_this$props3.layout,gestureDirection=_this$props3.gestureDirection,gestureVelocityImpact=_this$props3.gestureVelocityImpact,closing=_this$props3.closing;var width=layout.width,height=layout.height;if(width!==prevProps.layout.width){this.layout.width.setValue(width);}if(height!==prevProps.layout.height){this.layout.height.setValue(height);}if(gestureVelocityImpact!==prevProps.gestureVelocityImpact){this.gestureVelocityImpact.setValue(gestureVelocityImpact);}if(gestureDirection!==prevProps.gestureDirection){this.direction.setValue(gestureDirection==='vertical'?DIRECTION_VERTICAL:DIRECTION_HORIZONTAL);}if(closing!==prevProps.closing){requestAnimationFrame(function(){return requestAnimationFrame(function(){return _this2.isClosing.setValue(closing?TRUE:FALSE);});});}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.handleEndInteraction();if(this.isRunningAnimation||this.noAnimationStartedSoFar){this.props.onClose(false);}}},{key:"gestureActivationCriteria",value:function gestureActivationCriteria(){var _this$props4=this.props,layout=_this$props4.layout,gestureDirection=_this$props4.gestureDirection,gestureResponseDistance=_this$props4.gestureResponseDistance;var distance=gestureDirection==='vertical'?gestureResponseDistance&&gestureResponseDistance.vertical!==undefined?gestureResponseDistance.vertical:GESTURE_RESPONSE_DISTANCE_VERTICAL:gestureResponseDistance&&gestureResponseDistance.horizontal!==undefined?gestureResponseDistance.horizontal:GESTURE_RESPONSE_DISTANCE_HORIZONTAL;if(gestureDirection==='vertical'){return{maxDeltaX:15,minOffsetY:5,hitSlop:{bottom:-layout.height+distance}};}else{var hitSlop=-layout.width+distance;if(_reactNative.I18nManager.isRTL){return{minOffsetX:-5,maxDeltaY:20,hitSlop:{left:hitSlop}};}else{return{minOffsetX:5,maxDeltaY:20,hitSlop:{right:hitSlop}};}}}},{key:"render",value:function render(){var _this$props5=this.props,active=_this$props5.active,transparent=_this$props5.transparent,styleInterpolator=_this$props5.styleInterpolator,index=_this$props5.index,current=_this$props5.current,next=_this$props5.next,layout=_this$props5.layout,insets=_this$props5.insets,overlayEnabled=_this$props5.overlayEnabled,shadowEnabled=_this$props5.shadowEnabled,gestureEnabled=_this$props5.gestureEnabled,gestureDirection=_this$props5.gestureDirection,children=_this$props5.children,customContainerStyle=_this$props5.containerStyle,contentStyle=_this$props5.contentStyle,rest=(0,_objectWithoutProperties2.default)(_this$props5,["active","transparent","styleInterpolator","index","current","next","layout","insets","overlayEnabled","shadowEnabled","gestureEnabled","gestureDirection","children","containerStyle","contentStyle"]);if(!this.isRunningAnimation){this.interpolatedStyle=this.getInterpolatedStyle(styleInterpolator,index,current,next,layout,insets.top,insets.right,insets.bottom,insets.left);}var _this$interpolatedSty=this.interpolatedStyle,containerStyle=_this$interpolatedSty.containerStyle,cardStyle=_this$interpolatedSty.cardStyle,overlayStyle=_this$interpolatedSty.overlayStyle,shadowStyle=_this$interpolatedSty.shadowStyle;var handleGestureEvent=gestureEnabled?gestureDirection==='vertical'?this.handleGestureEventVertical:this.handleGestureEventHorizontal:undefined;return React.createElement(_StackGestureContext.default.Provider,{value:this.gestureRef,__source:{fileName:_jsxFileName,lineNumber:802}},React.createElement(_reactNative.View,(0,_extends2.default)({pointerEvents:"box-none"},rest,{__source:{fileName:_jsxFileName,lineNumber:803}}),React.createElement(_reactNativeReanimated.default.Code,{key:gestureEnabled?'gesture-code':'no-gesture-code',exec:gestureEnabled?this.execWithGesture:this.execNoGesture,__source:{fileName:_jsxFileName,lineNumber:804}}),overlayEnabled&&overlayStyle?React.createElement(_reactNativeReanimated.default.View,{pointerEvents:"none",style:[styles.overlay,overlayStyle],__source:{fileName:_jsxFileName,lineNumber:809}}):null,React.createElement(_reactNativeReanimated.default.View,{style:[styles.container,containerStyle,customContainerStyle],pointerEvents:"box-none",__source:{fileName:_jsxFileName,lineNumber:814}},React.createElement(_reactNativeGestureHandler.PanGestureHandler,(0,_extends2.default)({ref:this.gestureRef,enabled:layout.width!==0&&gestureEnabled,onGestureEvent:handleGestureEvent,onHandlerStateChange:handleGestureEvent},this.gestureActivationCriteria(),{__source:{fileName:_jsxFileName,lineNumber:818}}),React.createElement(_reactNativeReanimated.default.View,{style:[styles.container,cardStyle],__source:{fileName:_jsxFileName,lineNumber:825}},shadowEnabled&&shadowStyle&&!transparent?React.createElement(_reactNativeReanimated.default.View,{style:[styles.shadow,gestureDirection==='horizontal'?styles.shadowHorizontal:styles.shadowVertical,shadowStyle],pointerEvents:"none",__source:{fileName:_jsxFileName,lineNumber:827}}):null,React.createElement(_PointerEventsView.default,{active:active,progress:this.props.current,style:[styles.content,transparent?styles.transparent:styles.opaque,contentStyle],__source:{fileName:_jsxFileName,lineNumber:838}},children))))));}}]);return Card;}(React.Component);exports.default=Card;Card.defaultProps={overlayEnabled:_reactNative.Platform.OS!=='ios',shadowEnabled:true,gestureEnabled:true,gestureVelocityImpact:GESTURE_VELOCITY_IMPACT};var styles=_reactNative.StyleSheet.create({container:{flex:1},content:{flex:1,overflow:'hidden'},overlay:_objectSpread({},_reactNative.StyleSheet.absoluteFillObject,{backgroundColor:'#000'}),shadow:{position:'absolute',backgroundColor:'#fff',shadowRadius:5,shadowColor:'#000',shadowOpacity:0.3},shadowHorizontal:{top:0,left:0,bottom:0,width:3,shadowOffset:{width:-1,height:1}},shadowVertical:{top:0,left:0,right:0,height:3,shadowOffset:{width:1,height:-1}},transparent:{backgroundColor:'transparent'},opaque:{backgroundColor:'#eee'}});
//# sourceMappingURL=Card.js.map